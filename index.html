<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --background: #f8fafc;
            --card: rgba(255, 255, 255, 0.8);
            --text: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --focus: #818cf8;
            --success: #22c55e;
            --error: #ef4444;
            --input-bg: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .container {
            background: var(--card);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 32rem;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 1.875rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--input-bg);
            color: var(--text);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--focus);
            box-shadow: 0 0 0 2px var(--focus);
            background: var(--card);
        }

        textarea {
            resize: vertical;
            min-height: 5rem;
        }

        button {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: var(--primary-hover);
        }

        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .category-description {
            margin-top: 0.75rem;
            padding: 1rem;
            background: var(--input-bg);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: none;
        }

        .category-description.active {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        .category-description ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        .category-description li {
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .category-description li::before {
            content: "•";
            position: absolute;
            left: 0.5rem;
            color: var(--primary);
        }

        #message {
            margin-top: 1rem;
            text-align: center;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-0.5rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .input-wrapper {
            position: relative;
        }

        .input-wrapper svg {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .image-upload {
            margin-top: 1rem;
        }

        .image-preview {
            margin-top: 1rem;
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            display: none;
        }

        .camera-container {
            margin-top: 1rem;
            text-align: center;
        }

        .camera-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background: var(--primary);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            border: none;
            margin-bottom: 1rem;
        }

        .camera-button:hover {
            background: var(--primary-hover);
        }

        #imageInput {
            display: none;
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }

            .container {
                padding: 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Expense Tracker</h1>
            <p>Track expenses effortlessly</p>
        </header>
        
        <form id="expenseForm">
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
            </div>
            
            <div class="form-group">
                <label for="category">Category</label>
                <select id="category" name="category" required>
                    <option value="">Select a category</option>
                    <option value="Infrastructure & Equipment">Infrastructure & Equipment</option>
                    <option value="Consumable">Consumable</option>
                    <option value="Livestock">Livestock</option>
                    <option value="Maintenance & Repairs">Maintenance & Repairs</option>
                    <option value="Operational Costs">Operational Costs</option>
                    <option value="Research & Development">Research & Development</option>
                    <option value="Marketing & Sales">Marketing & Sales</option>
                </select>
                <div id="categoryDescription" class="category-description"></div>
            </div>
            
            <div class="form-group">
                <label for="vendor">Vendor/Payee</label>
                <input type="text" id="vendor" name="vendor" required>
            </div>
            
            <div class="form-group">
                <label for="amount">Amount (£)</label>
                <div class="input-wrapper">
                    <input type="number" id="amount" name="amount" step="0.01" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="paymentMethod">Payment Method</label>
                <select id="paymentMethod" name="paymentMethod" required>
                    <option value="Paypal">PayPal</option>
                    <option value="Credit Card">Credit Card</option>
                    <option value="Debit Card">Debit Card</option>
                    <option value="Cash">Cash</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="receiptID">Receipt ID</label>
                <input type="text" id="receiptID" name="receiptID">
            </div>
            
            <div class="form-group">
                <label>Receipt Image</label>
                <div class="camera-container">
                    <input type="file" id="imageInput" accept="image/*" capture="environment">
                    <button type="button" class="camera-button" id="captureButton">
                        <i class="fas fa-camera"></i> Capture Receipt
                    </button>
                </div>
                <img id="imagePreview" class="image-preview" alt="Receipt preview">
            </div>
            
            <button type="submit">Add Expense</button>
        </form>
        
        <p id="message"></p>
    </div>

    <script>
        // Category descriptions
        const categoryDescriptions = {
            'Infrastructure & Equipment': `
                <ul>
                    <li>Tanks, Grow Beds and Plumbing</li>
                    <li>Pumps (Water & Air)</li>
                    <li>Lighting (LEDs, Grow Lights)</li>
                    <li>Sensors & Monitoring Equipment (pH, EC, DO sensors)</li>
                </ul>
            `,
            'Consumable': `
                <ul>
                    <li>Fish Feed</li>
                    <li>Seeds & Seedlings</li>
                    <li>Water & Electricity</li>
                    <li>pH Balancers & Water Treatments</li>
                    <li>Nutrients & Supplements</li>
                </ul>
            `,
            'Livestock': `
                <ul>
                    <li>Fish Stock</li>
                    <li>Replacement Cost for Fish Losses</li>
                </ul>
            `,
            'Maintenance & Repairs': `
                <ul>
                    <li>Equipment Repairs & Replacements</li>
                    <li>Plumbing & Structural Maintenance</li>
                    <li>Cleaning Supplies</li>
                </ul>
            `,
            'Operational Costs': `
                <ul>
                    <li>Labor & Wages</li>
                    <li>Permits & Licenses</li>
                    <li>Insurance</li>
                </ul>
            `,
            'Research & Development': `
                <ul>
                    <li>Testing Kits & Lab Analysis</li>
                    <li>Experimentation Costs</li>
                </ul>
            `,
            'Marketing & Sales': `
                <ul>
                    <li>Packaging & Distribution</li>
                    <li>Online Store Fees</li>
                    <li>Advertising & Promotions</li>
                </ul>
            `
        };

        // Image handling code
        const imageInput = document.getElementById('imageInput');
        const captureButton = document.getElementById('captureButton');
        const imagePreview = document.getElementById('imagePreview');
        let imageBase64 = '';

        captureButton.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imageBase64 = e.target.result;
                    imagePreview.src = imageBase64;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Category selection handling
        document.getElementById('category').addEventListener('change', function(e) {
            const descriptionElement = document.getElementById('categoryDescription');
            const selectedCategory = this.value;
            
            if (selectedCategory && categoryDescriptions[selectedCategory]) {
                descriptionElement.innerHTML = categoryDescriptions[selectedCategory];
                descriptionElement.classList.add('active');
            } else {
                descriptionElement.innerHTML = '';
                descriptionElement.classList.remove('active');
            }
        });

        // Form submission handling (single, unified handler)
        const form = document.getElementById('expenseForm');
        const message = document.getElementById('message');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            message.textContent = 'Saving expense...';
            message.style.color = 'var(--primary)';
            
            const dateInput = document.getElementById('date').value;
            const formattedDate = new Date(dateInput).toLocaleDateString('en-GB');
            
            const formData = new FormData();
            formData.append('date', formattedDate);
            formData.append('category', document.getElementById('category').value);
            formData.append('vendor', document.getElementById('vendor').value);
            formData.append('amount', document.getElementById('amount').value);
            formData.append('paymentMethod', document.getElementById('paymentMethod').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('receiptID', document.getElementById('receiptID').value);
            formData.append('receiptImage', imageBase64); // Add image data

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwBKUMMEKyDJ-gefcPNvFxvEJdTgPiwa2ibWOtXfJnmg2DkkRG74ODj9M5J9Dtx5AOy/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });

                await new Promise(resolve => setTimeout(resolve, 2000));
                
                message.textContent = 'Expense added successfully!';
                message.style.color = 'var(--success)';
                form.reset();
                imagePreview.style.display = 'none';
                imageBase64 = '';
                document.getElementById('categoryDescription').classList.remove('active');
                
            } catch (error) {
                console.error('Error:', error);
                message.textContent = 'Error saving expense. Please try again.';
                message.style.color = 'var(--error)';
            } finally {
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>